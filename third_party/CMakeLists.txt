
include(ExternalProject)

set(THIRD_PARTY_LIBRARIES "")
set(THIRD_PARTY_LIB_DIRS "")
set(THIRD_PARTY_INCLUDES "")
set(THIRD_PARTY_DEPENDENCIES "")

# TinyWav
add_library(tinywav STATIC tinywav/tinywav.c)
list(APPEND THIRD_PARTY_INCLUDES "${CMAKE_CURRENT_SOURCE_DIR}/tinywav")
list(APPEND THIRD_PARTY_LIBRARIES tinywav)

# Q library
set(HARMONIZER_Q_PATH "${CMAKE_CURRENT_SOURCE_DIR}/Q")
set(Q_INCLUDE "${HARMONIZER_Q_PATH}/q_lib/include/")
message(STATUS "Q headers location is ${Q_INCLUDE}")
list(APPEND THIRD_PARTY_INCLUDES
    "${Q_INCLUDE}"
    "${HARMONIZER_Q_PATH}/infra/include/")

# FFTW3
set(FFTW3_INSTALL_DIR "${CMAKE_BINARY_DIR}/third_party/fftw3/install")
message(STATUS "Installing FFTW3 in ${FFTW3_INSTALL_DIR}")
ExternalProject_Add(
    fftw3
    PREFIX fftw3
    UPDATE_DISCONNECTED 1
    URL https://www.fftw.org/fftw-3.3.10.tar.gz
    CONFIGURE_COMMAND ./configure --enable-float --prefix "${FFTW3_INSTALL_DIR}"
    BUILD_COMMAND make -j4
    BUILD_IN_SOURCE 1
)
list(APPEND THIRD_PARTY_INCLUDES ${FFTW3_INSTALL_DIR}/include)
list(APPEND THIRD_PARTY_LIBRARIES "${FFTW3_INSTALL_DIR}/lib/fftw3f")
list(APPEND THIRD_PARTY_DEPENDENCIES fftw3)

set(THIRD_PARTY_LIBRARIES ${THIRD_PARTY_LIBRARIES} PARENT_SCOPE)
set(THIRD_PARTY_LIB_DIRS ${THIRD_PARTY_LIB_DIRS} PARENT_SCOPE)
set(THIRD_PARTY_INCLUDES ${THIRD_PARTY_INCLUDES} PARENT_SCOPE)
set(THIRD_PARTY_DEPENDENCIES ${THIRD_PARTY_DEPENDENCIES} PARENT_SCOPE)
